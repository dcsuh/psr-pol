---
title: "BRT plots"
output: html_document
date: "2023-07-14"
---

```{r packages}
library(here)
library(tidyverse)
library(magrittr)

library(dismo)
library(gbm)
```

```{r data}
var_type <- read_csv(here("data/var_type.csv"))

brt1_elith_full <- readRDS(here("processed_data/brt_results/full_elith.rds"))
brt2_elith_helm <- readRDS(here("processed_data/brt_results/helm_elith.rds"))
brt3_elith_virus <- readRDS(here("processed_data/brt_results/virus_elith.rds"))
brt4_elith_arth <- readRDS(here("processed_data/brt_results/arth_elith.rds"))
brt5_elith_bact <- readRDS(here("processed_data/brt_results/bact_elith.rds"))
brt6_elith_proto <- readRDS(here("processed_data/brt_results/proto_elith.rds"))

summary(brt1_elith_full)
summary(brt2_elith_helm)
summary(brt3_elith_virus)
summary(brt4_elith_arth)
summary(brt5_elith_bact)
summary(brt6_elith_proto)
```

```{r gmpd pdp 6}
gbm.plot(brt1_elith_full, n.plots=6, plot.layout=c(2, 3), write.title = FALSE, common.scale = T, main = "full")
gbm.plot(brt2_elith_helm, n.plots=6, plot.layout=c(2, 3), write.title = FALSE, common.scale = T, main = "helminth")
gbm.plot(brt3_elith_virus, n.plots=6, plot.layout=c(2, 3), write.title = FALSE, common.scale = T, main = "virus")
gbm.plot(brt4_elith_arth, n.plots=6, plot.layout=c(2, 3), write.title = FALSE, common.scale = T, main = "arthropod")
gbm.plot(brt5_elith_bact, n.plots=6, plot.layout=c(2, 3), write.title = FALSE, common.scale = T, main = "bacteria")
gbm.plot(brt6_elith_proto, n.plots=6, plot.layout=c(2, 3), write.title = FALSE, common.scale = T, main = "protozoa")
```

```{r plot gbm test}
plot.gbm(brt1_elith_full, n.plots=6, plot.layout=c(2, 3), write.title = FALSE, common.scale = T, main = "full")

```

```{r plot longevity}
brt1_names <- brt1_elith_full$var.names
brt2_names <- brt2_elith_helm$var.names
brt3_names <- brt3_elith_virus$var.names
brt4_names <- brt4_elith_arth$var.names
brt5_names <- brt5_elith_bact$var.names
brt6_names <- brt6_elith_proto$var.names

brt1_long_plot_no <- which(brt1_names %in% c("MaxLongevity_m"))
brt2_long_plot_no <- which(brt2_names %in% c("MaxLongevity_m"))
brt3_long_plot_no <- which(brt3_names %in% c("MaxLongevity_m"))
brt4_long_plot_no <- which(brt4_names %in% c("MaxLongevity_m"))
brt5_long_plot_no <- which(brt5_names %in% c("MaxLongevity_m"))
brt6_long_plot_no <- which(brt6_names %in% c("MaxLongevity_m"))

gbm.plot(brt1_elith_full, variable.no = brt1_long_plot_no, plot.layout=c(1, 1), write.title = FALSE, main = "full")
gbm.plot(brt2_elith_helm, variable.no = brt2_long_plot_no, plot.layout=c(1, 1), write.title = FALSE, main = "helm")
gbm.plot(brt3_elith_virus, variable.no = brt3_long_plot_no, plot.layout=c(1, 1), write.title = FALSE, main = "virus")
gbm.plot(brt4_elith_arth, variable.no = brt4_long_plot_no, plot.layout=c(1, 1), write.title = FALSE, main = "arth")
gbm.plot(brt5_elith_bact, variable.no = brt5_long_plot_no, plot.layout=c(1, 1), write.title = FALSE, main = "bact")
gbm.plot(brt6_elith_proto, variable.no = brt6_long_plot_no, plot.layout=c(1, 1), write.title = FALSE, main = "proto")
```

```{r plot gbm longevity}
plot.gbm(brt1_elith_full, n.plots=6, i.var = brt1_long_plot_no, main = "full", type = "response")
plot.gbm(brt2_elith_helm, n.plots=6, i.var = brt2_long_plot_no, main = "helminth", type = "response")
plot.gbm(brt3_elith_virus, n.plots=6, i.var = brt3_long_plot_no, main = "virus", type = "response")
plot.gbm(brt4_elith_arth, n.plots=6, i.var = brt4_long_plot_no, main = "arthropod", type = "response")
plot.gbm(brt5_elith_bact, n.plots=6, i.var = brt5_long_plot_no, main = "bacteria", type = "response")
plot.gbm(brt6_elith_proto, n.plots=6, i.var = brt6_long_plot_no, main = "protozoa", type = "response")
```


```{r relative importance}
brt1_full_ri <- brt1_elith_full$contributions
brt2_helm_ri <- brt2_elith_helm$contributions
brt3_virus_ri <- brt3_elith_virus$contributions
brt4_arth_ri <- brt4_elith_arth$contributions
brt5_bact_ri <- brt5_elith_bact$contributions
brt6_proto_ri <- brt6_elith_proto$contributions
```

```{r bind rows}
brt1_full_ri %<>% mutate(par_type = "full")
brt2_helm_ri %<>% mutate(par_type = "helminth")
brt3_virus_ri %<>% mutate(par_type = "virus")
brt4_arth_ri %<>% mutate(par_type = "arthropod")
brt5_bact_ri %<>% mutate(par_type = "bacteria")
brt6_proto_ri %<>% mutate(par_type = "protozoa")

brt_ri <- bind_rows(brt1_full_ri, brt2_helm_ri, brt3_virus_ri, brt4_arth_ri, brt5_bact_ri, brt6_proto_ri)
rownames(brt_ri) <- NULL
```


```{r}
brt_ri %<>% group_by(par_type) %>%
  arrange(desc(rel.inf)) %>%
  mutate(ranking = row_number())

var_type %<>% mutate(var = variable) %>% dplyr::select(-c(variable))

brt_ri %<>% left_join(., var_type)
```


```{r}
brt_ri %>% filter(par_type != "full") %>%
ggplot(data = ., aes(x = par_type, y = ranking, group = var)) +
  geom_line(aes(color = var)) +
  geom_point(aes(color = var, alpha = 1), size = 4) +
  scale_y_reverse(breaks = 1:nrow(brt_ri))
```


```{r}
brt_ri %>% filter(par_type != "full") %>%
ggplot(data = ., aes(x = par_type, y = ranking, group = var)) +
  geom_line(aes(color = var_type)) +
  geom_point(aes(color = var_type), size = 4) +
  scale_y_reverse(breaks = 1:nrow(brt_ri)) + 
  theme_minimal()
```


